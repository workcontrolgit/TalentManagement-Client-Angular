<div class="container-fluid">
  <form [formGroup]="entryForm" novalidate>
    <div class="card shadow-sm">
      <div class="card-header bg-light">
        <div class="d-flex justify-content-between align-items-center">
          <div>
            <h3 class="text-secondary mb-0">
              <i class="fas fa-dollar-sign me-2"></i>
              {{ formMode() === 'New' ? 'New Salary Range' : 'Edit Salary Range' }}
            </h3>
          </div>
          <div>
            <a
              class="btn btn-outline-secondary"
              ngbTooltip="Return to Salary Range List"
              [routerLink]="['/salaryrange']"
              [class.disabled]="isLoading()"
            >
              <i class="fas fa-arrow-left me-1"></i> Back
            </a>
          </div>
        </div>
      </div>

      <div class="card-body">
        <!-- Loading State -->
        @if(isLoading()) {
        <div class="d-flex justify-content-center align-items-center py-4">
          <div class="spinner-border text-primary me-2" role="status">
            <span class="visually-hidden">Loading...</span>
          </div>
          <span>Processing...</span>
        </div>
        }

        <!-- Error State -->
        @if(error()) {
        <div class="alert alert-danger d-flex align-items-center" role="alert">
          <i class="fas fa-exclamation-triangle me-2"></i>
          {{ error() }}
        </div>
        }

        <!-- Salary Range Summary (Edit Mode Only) -->
        @if(!isAddNew() && salaryRange()) {
        <div class="alert alert-info d-flex align-items-center mb-4" role="alert">
          <i class="fas fa-info-circle me-2"></i>
          <div>
            <strong>Current Range:</strong> {{ salaryRange()!.minSalary | currency : 'USD' : 'symbol' : '1.0-0' }} -
            {{ salaryRange()!.maxSalary | currency : 'USD' : 'symbol' : '1.0-0' }}
            <span class="ms-2 badge bg-primary"
              >Span: {{ salaryRangeAmount() | currency : 'USD' : 'symbol' : '1.0-0' }}</span
            >
          </div>
        </div>
        }

        <!-- Form Validation Error -->
        @if(entryForm.errors?.['salaryRangeInvalid'] && (f['minSalary'].touched || f['maxSalary'].touched)) {
        <div class="alert alert-warning d-flex align-items-center mb-4" role="alert">
          <i class="fas fa-exclamation-triangle me-2"></i>
          Maximum salary must be greater than minimum salary.
        </div>
        }

        <div class="row">
          <div class="col-12">
            <div class="mb-3">
              <label for="id" class="form-label fw-bold">
                <i class="fas fa-fingerprint me-1"></i>Salary Range ID
              </label>
              <input
                type="text"
                id="id"
                class="form-control bg-light"
                formControlName="id"
                readonly
                ngbTooltip="Auto-generated unique identifier"
              />
            </div>

            <div class="mb-4">
              <label for="name" class="form-label fw-bold">
                <i class="fas fa-tag me-1"></i>Name <span class="text-danger">*</span>
              </label>
              <input
                type="text"
                id="name"
                class="form-control"
                [class.is-invalid]="f['name'].invalid && f['name'].touched"
                [class.is-valid]="f['name'].valid && f['name'].touched"
                formControlName="name"
                placeholder="e.g., Entry Level, Mid-Level, Senior Level"
                ngbTooltip="Name must be at least 2 characters long"
              />
              @if(f['name'].invalid && f['name'].touched) {
              <div class="invalid-feedback">
                @if(f['name'].errors?.['required']) {
                <div>Name is required</div>
                } @if(f['name'].errors?.['minlength']) {
                <div>Name must be at least 2 characters long</div>
                }
              </div>
              }
            </div>

            <!-- Salary Range Section -->
            <div class="salary-range-section mb-4">
              <h5 class="mb-3"><i class="fas fa-chart-bar me-2"></i>Salary Range Configuration</h5>

              <div class="row">
                <div class="col-md-6">
                  <div class="mb-3">
                    <label for="minSalary" class="form-label fw-bold">
                      <i class="fas fa-arrow-down me-1 text-success"></i>Minimum Salary
                      <span class="text-danger">*</span>
                    </label>
                    <div class="input-group">
                      <span class="input-group-text">$</span>
                      <input
                        type="number"
                        id="minSalary"
                        class="form-control"
                        [class.is-invalid]="f['minSalary'].invalid && f['minSalary'].touched"
                        [class.is-valid]="f['minSalary'].valid && f['minSalary'].touched"
                        formControlName="minSalary"
                        placeholder="0"
                        min="0"
                        step="1000"
                        ngbTooltip="Minimum salary must be greater than or equal to 0"
                      />
                    </div>
                    @if(f['minSalary'].invalid && f['minSalary'].touched) {
                    <div class="invalid-feedback d-block">
                      @if(f['minSalary'].errors?.['required']) {
                      <div>Minimum salary is required</div>
                      } @if(f['minSalary'].errors?.['min']) {
                      <div>Minimum salary must be greater than or equal to 0</div>
                      }
                    </div>
                    }
                  </div>
                </div>

                <div class="col-md-6">
                  <div class="mb-3">
                    <label for="maxSalary" class="form-label fw-bold">
                      <i class="fas fa-arrow-up me-1 text-danger"></i>Maximum Salary <span class="text-danger">*</span>
                    </label>
                    <div class="input-group">
                      <span class="input-group-text">$</span>
                      <input
                        type="number"
                        id="maxSalary"
                        class="form-control"
                        [class.is-invalid]="f['maxSalary'].invalid && f['maxSalary'].touched"
                        [class.is-valid]="f['maxSalary'].valid && f['maxSalary'].touched"
                        formControlName="maxSalary"
                        placeholder="0"
                        min="0"
                        step="1000"
                        ngbTooltip="Maximum salary must be greater than minimum salary"
                      />
                    </div>
                    @if(f['maxSalary'].invalid && f['maxSalary'].touched) {
                    <div class="invalid-feedback d-block">
                      @if(f['maxSalary'].errors?.['required']) {
                      <div>Maximum salary is required</div>
                      } @if(f['maxSalary'].errors?.['min']) {
                      <div>Maximum salary must be greater than or equal to 0</div>
                      }
                    </div>
                    }
                  </div>
                </div>
              </div>

              <!-- Real-time Range Display -->
              @if(f['minSalary'].value && f['maxSalary'].value && f['minSalary'].value < f['maxSalary'].value) {
              <div class="alert alert-light d-flex align-items-center">
                <i class="fas fa-calculator me-2 text-info"></i>
                <div>
                  <strong>Salary Range Preview:</strong>
                  {{ f['minSalary'].value | currency : 'USD' : 'symbol' : '1.0-0' }} -
                  {{ f['maxSalary'].value | currency : 'USD' : 'symbol' : '1.0-0' }}
                  <span class="ms-3 badge bg-info"
                    >Span:
                    {{ f['maxSalary'].value - f['minSalary'].value | currency : 'USD' : 'symbol' : '1.0-0' }}</span
                  >
                </div>
              </div>
              }
            </div>

            @if(!isAddNew()) {
            <div class="row">
              <div class="col-md-6">
                <div class="mb-3">
                  <label for="createdBy" class="form-label fw-bold"> <i class="fas fa-user me-1"></i>Created By </label>
                  <input
                    type="text"
                    id="createdBy"
                    class="form-control bg-light"
                    formControlName="createdBy"
                    readonly
                  />
                </div>
              </div>
              <div class="col-md-6">
                <div class="mb-3">
                  <label for="created" class="form-label fw-bold">
                    <i class="fas fa-calendar-plus me-1"></i>Created Date
                  </label>
                  <input
                    type="text"
                    id="created"
                    class="form-control bg-light"
                    [value]="salaryRange()?.created | date : 'medium'"
                    readonly
                  />
                </div>
              </div>
            </div>

            <div class="row">
              <div class="col-md-6">
                <div class="mb-3">
                  <label for="lastModifiedBy" class="form-label fw-bold">
                    <i class="fas fa-user-edit me-1"></i>Last Modified By
                  </label>
                  <input
                    type="text"
                    id="lastModifiedBy"
                    class="form-control bg-light"
                    formControlName="lastModifiedBy"
                    readonly
                  />
                </div>
              </div>
              <div class="col-md-6">
                <div class="mb-3">
                  <label for="lastModified" class="form-label fw-bold">
                    <i class="fas fa-calendar-edit me-1"></i>Last Modified Date
                  </label>
                  <input
                    type="text"
                    id="lastModified"
                    class="form-control bg-light"
                    [value]="salaryRange()?.lastModified | date : 'medium'"
                    readonly
                  />
                </div>
              </div>
            </div>
            }
          </div>
        </div>
      </div>

      <div class="card-footer bg-light">
        <div class="d-flex justify-content-between">
          <div>
            @if(canDelete()) {
            <button
              type="button"
              class="btn btn-danger"
              [disabled]="isLoading()"
              (click)="onDelete()"
              ngbTooltip="Delete this salary range permanently"
            >
              <i class="fas fa-trash me-1"></i>
              @if(isLoading()) {
              <span class="spinner-border spinner-border-sm me-1"></span>
              } Delete
            </button>
            }
          </div>
          <div>
            @if(isAddNew()) {
            <button
              type="button"
              class="btn btn-success"
              [disabled]="!canSave()"
              (click)="onCreate()"
              ngbTooltip="Create new salary range"
            >
              <i class="fas fa-plus me-1"></i>
              @if(isLoading()) {
              <span class="spinner-border spinner-border-sm me-1"></span>
              } Create
            </button>
            } @else {
            <button
              type="button"
              class="btn btn-primary"
              [disabled]="!canSave()"
              (click)="onUpdate()"
              ngbTooltip="Save changes to salary range"
            >
              <i class="fas fa-save me-1"></i>
              @if(isLoading()) {
              <span class="spinner-border spinner-border-sm me-1"></span>
              } Save Changes
            </button>
            }
          </div>
        </div>
      </div>
    </div>
  </form>
</div>
